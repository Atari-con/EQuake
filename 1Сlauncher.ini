

Процедура ЗапуститьЭкспортДанных()
    
    ПутьЭкспорта = "C:\export\";
    ТипДанных = "Маршруты"; 
    Формат = "JSON";

    
    ЭкспортДанных(ПутьЭкспорта, ТипДанных, Формат);
КонецПроцедуры

Процедура ЭкспортДанных(ПутьЭкспорта, ТипДанных, Формат)
  
    ДанныеДляЭкспорта = ПолучитьДанные(ТипДанных);

    ФайлЭкспорта = Новый ЗаписьТекстаФайла(ПутьЭкспорта + ТипДанных + ".json", КодировкаТекста.UTF8);
    ФайлЭкспорта.Записать(ДанныеДляЭкспорта);
    ФайлЭкспорта.Закрыть();
КонецПроцедуры

Функция ПолучитьДанные(ТипДанных) Экспорт
    
    ДанныеJSON = "";

    Если ТипДанных = "Маршруты" Тогда
        
        Запрос = Новый Запрос;
        Запрос.Текст = "ВЫБРАТЬ * ИЗ Маршруты";

        РезультатЗапроса = Запрос.Выполнить();
        Выборка = РезультатЗапроса.Выбрать();

        Данные = Новый Структура;

        Пока Выборка.Следующий() Цикл
            Маршрут = Новый Структура;
            Маршрут.Вставить("ID", Выборка.ID);
            Маршрут.Вставить("Название", Выборка.Название);
            Маршрут.Вставить("Описание", Выборка.Описание);
            Маршрут.Вставить("Пользователь", Выборка.Пользователь);
            Маршрут.Вставить("ДатаСоздания", Выборка.ДатаСоздания);

            
            ЗапросТочки = Новый Запрос;
            ЗапросТочки.Текст = "ВЫБРАТЬ * ИЗ ТочкиМаршрута ГДЕ Маршрут = &Маршрут";
            ЗапросТочки.УстановитьПараметр("Маршрут", Выборка.ID);
            РезультатЗапросаТочки = ЗапросТочки.Выполнить();
            ВыборкаТочки = РезультатЗапросаТочки.Выбрать();

            Маршрут.Точки = Новый Массив;

            Пока ВыборкаТочки.Следующий() Цикл
                Точка = Новый Структура;
                Точка.Вставить("Долгота", ВыборкаТочки.Долгота);
                Точка.Вставить("Широта", ВыборкаТочки.Широта);
                Точка.Вставить("Описание", ВыборкаТочки.Описание);
                Маршрут.Точки.Добавить(Точка);
            КонецЦикла;

            Данные.Добавить(Маршрут);
        КонецЦикла;

        ДанныеJSON = СтрПреобразоватьJSON(Данные);
    КонецЕсли;

 
    
    Возврат ДанныеJSON;
КонецФункции
